steps:
  - name: Debug Files
  image: alpine
  commands:
    - ls -la /woodpecker/src

  - name: Deploy to Kubernetes
    image: lachlanevenson/k8s-kubectl:latest
    volumes:
    - /woodpecker/src:/workspace
    environment:
      KUBECONFIG_CONTENT:
        from_secret: KUBE_CONFIG
    commands:
      - mkdir -p /root/.kube
      - echo "$KUBECONFIG_CONTENT" > /root/.kube/config
      - kubectl cluster-info
      - cd /workspace
      - kubectl apply -f deployment.yaml
